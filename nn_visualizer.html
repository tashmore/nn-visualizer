<meta charset="UTF-8">
<html>
<head>
    <title>Neural Net Visualizer</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
</head>

<body>
    <div id='net'></div>

    <script type="text/javascript">
        function drawNN(weights, nodeValues) {

            var svg = d3.select('#net').append("svg")
                                  .attr("width", 1000)
                                  .attr("height", 800)
                                  .attr("class", "chart")
            svg.append("g").attr("id", "edges")
            svg.append("g").attr("id", "nodes")

            drawNodes(nodeValues)
            var nodeData = d3.selectAll('.layer').data()
            drawEdges(weights, nodeData)
        }

        function drawEdges(weights, nodeData) {
            function getEdgeData(fromLayer, fromNode, toNode, weight) {
                var fromNode = nodeData[fromLayer][fromNode]
                var toNode = nodeData[fromLayer + 1][toNode]

                return {x1: fromNode.x + fromNode.width,
                        y1: fromNode.y + fromNode.height/2,
                        x2: toNode.x,
                        y2: toNode.y + toNode.height/2,
                        weight: weight}
            }

            var data = []
            for (var i=0; i<weights.length; i++) {
                for (var j=0; j<weights[i].length; j++) {
                    for (var k=0; k<weights[i][j].length; k++) {
                        data.push(getEdgeData(i, j, k, weights[i][j][k]))
                    }
                }
            }

            d3.select('svg').select('#edges').selectAll('.edge')
                            .data(data)
                          .enter().append('svg:line')
                            .attr('class', 'edge')
                            .attr("x1", function(d) { return d.x1; })
                            .attr("y1", function(d) { return d.y1; })
                            .attr("x2", function(d) { return d.x2; })
                            .attr("y2", function(d) { return d.y2; })
                            .style('stroke-width', function(d) { return 10*Math.abs(d.weight); })
                            .style('stroke', function(d) { return d.weight > 0 ? 'blue' : 'red' })
        }

        function drawNodes(nodeValues) {
            function getNodeData(layerIdx, nodeIdx, value) {
                var width = 50
                var height = 50
                var wPadding = 100
                var hPadding = 15
                return {x: layerIdx * (width + wPadding),
                        y: nodeIdx * (height + hPadding),
                        width: width,
                        height: height,
                        value: nodeValues[layerIdx][nodeIdx]}
            }

            var data = []
            for (var i=0; i<nodeValues.length; i++) {
                data.push([])
                for (var j=0; j<nodeValues[i].length; j++) {
                    data[i].push(getNodeData(i, j))
                }
            }

            var layer = d3.select('svg').select('#nodes').selectAll(".layer")
                            .data(data)
                          .enter().append("svg:g")
                            .attr("class", "layer")

            var col = layer.selectAll(".node")
                         .data(function (d) { return d; })
                        .enter().append("svg:rect")
                         .attr("class", "node")
                         .attr("x", function(d) { return d.x; })
                         .attr("y", function(d) { return d.y; })
                         .attr("width", function(d) { return d.width; })
                         .attr("height", function(d) { return d.height; })
                         .style("fill", function(d) { var v = Math.floor(255*(1-d.value)); return "rgb("+v+","+v+","+v+")" })
                         .append("svg:title")
                         .text(function(d) { return d.value; });
        }

        drawNN(
            // weights
            [
              [ [.4, -.5], [.001, 2.3], [-.1, .2], [.3, .4] ],
              [ [1.2], [-1.2], [-0.1] ]
            ],

            // values
            [ [.1, .2, .3, 1], [.5, .4, 1], [.9] ])
    </script>
</body>
</html>